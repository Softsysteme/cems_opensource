
function DocumentToJSON(document) {
	// Find the variable having 'document' as name attribute
	var elt;
	var vars = document.getElementsByTagName("variable");
	for (i=0; i< vars.getLength(); i++) {
		if (vars.item(i).getAttributes().getNamedItem("name").getNodeValue() == "document") {
			var jsonString = Packages.com.twinsoft.convertigo.engine.util.XMLUtils.XmlToJson(vars.item(i), true);
			var jsonObj = JSON.parse(jsonString).variable;
			jsonObj.attr = null;
			return(JSON.stringify(jsonObj));
		}
	}
}

// Handles the transaction start event.
function onTransactionStarted() {
	if (id == undefined) {
		id = Packages.java.util.UUID.randomUUID().toString();
	}
	context.requestedObject.setHttpVerb(Packages.com.twinsoft.convertigo.beans.transactions.AbstractHttpTransaction.HTTP_VERB_PUT);
	if (rev == undefined)
		context.connector.sUrl += database + "/" + id; 
	else
		context.connector.sUrl += database + "/" + id + "?rev=" + rev;
		
    var data = DocumentToJSON(context.inputDocument);
    log.message(data);
    context.connector.postQuery = data;
}
